



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="区块链技术是金融科技（Fintech）领域的一项重要技术创新。">
      
      
      
        <meta name="author" content="yeasy">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="zh">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.5">
    
    
      
        <title>架构设计 - 区块链技术指南</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.bcabdff3.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="indigo" data-md-color-accent="indigo">
    
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="区块链技术指南" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                区块链技术指南
              </span>
              <span class="md-header-nav__topic">
                架构设计
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/wohugb/blockchain_guide" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      wohugb/blockchain_guide
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="前言" class="md-tabs__link">
        前言
      </a>
    
  </li>

      
        
      
        
      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../born/README/" title="灵感价值场景" class="md-tabs__link">
          灵感价值场景
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../distribute_system/README/" title="技术算法" class="md-tabs__link">
          技术算法
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../bitcoin/README/" title="实现" class="md-tabs__link">
          实现
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../fabric/intro/" title="Fabric" class="md-tabs__link">
          Fabric
        </a>
      
    </li>
  

  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../app_dev/intro/" title="区块链" class="md-tabs__link">
          区块链
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../evaluation/README/" title="性能与评测" class="md-tabs__link">
          性能与评测
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../appendix/terms/" title="附录" class="md-tabs__link">
          附录
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    区块链技术指南
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/wohugb/blockchain_guide" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      wohugb/blockchain_guide
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="前言" class="md-nav__link">
      前言
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../revision/" title="修订记录" class="md-nav__link">
      修订记录
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contribute/" title="如何贡献" class="md-nav__link">
      如何贡献
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      灵感价值场景
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        灵感价值场景
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      区块链思想
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        区块链思想
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../born/README/" title="诞生与概念" class="md-nav__link">
      诞生与概念
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../born/currency/" title="从数字货币说起" class="md-nav__link">
      从数字货币说起
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../born/bitcoin/" title="比特币：前所未有的社会学实验" class="md-nav__link">
      比特币：前所未有的社会学实验
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../born/what/" title="区块链核心概念" class="md-nav__link">
      区块链核心概念
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../born/summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      区块链技术
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        区块链技术
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/README/" title="价值、挑战与展望" class="md-nav__link">
      价值、挑战与展望
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/business/" title="商业价值" class="md-nav__link">
      商业价值
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/tech/" title="关键技术和挑战" class="md-nav__link">
      关键技术和挑战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/vision/" title="趋势与展望" class="md-nav__link">
      趋势与展望
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      典型应用场景
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        典型应用场景
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../scenario/README/" title="概述" class="md-nav__link">
      概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../scenario/trading/" title="金融服务" class="md-nav__link">
      金融服务
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../scenario/trust/" title="征信和权属管理" class="md-nav__link">
      征信和权属管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../scenario/sharing/" title="资源共享" class="md-nav__link">
      资源共享
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../scenario/capital/" title="投资管理" class="md-nav__link">
      投资管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../scenario/iot/" title="物联网与供应链" class="md-nav__link">
      物联网与供应链
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../scenario/others/" title="其它场景" class="md-nav__link">
      其它场景
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../scenario/summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      技术算法
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        技术算法
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      分布式系统
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        分布式系统
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../distribute_system/README/" title="核心问题" class="md-nav__link">
      核心问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../distribute_system/problem/" title="一致性问题" class="md-nav__link">
      一致性问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../distribute_system/consensus/" title="共识算法" class="md-nav__link">
      共识算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../distribute_system/flp/" title="FLP 不可能性原理" class="md-nav__link">
      FLP 不可能性原理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../distribute_system/cap/" title="CAP 原理" class="md-nav__link">
      CAP 原理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../distribute_system/acid/" title="ACID 原则" class="md-nav__link">
      ACID 原则
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../distribute_system/paxos/" title="Paxos 与 Raft" class="md-nav__link">
      Paxos 与 Raft
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../distribute_system/bft/" title="拜占庭问题与算法" class="md-nav__link">
      拜占庭问题与算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../distribute_system/availability/" title="可靠性指标" class="md-nav__link">
      可靠性指标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../distribute_system/summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      密码学与安全技术
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        密码学与安全技术
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../crypto/README/" title="概述" class="md-nav__link">
      概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../crypto/hash/" title="Hash 算法与摘要" class="md-nav__link">
      Hash 算法与摘要
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../crypto/algorithm/" title="加解密算法" class="md-nav__link">
      加解密算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../crypto/signature/" title="数字签名" class="md-nav__link">
      数字签名
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../crypto/cert/" title="数字证书" class="md-nav__link">
      数字证书
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../crypto/pki/" title="PKI 体系" class="md-nav__link">
      PKI 体系
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../crypto/merkle_trie/" title="Merkle 树" class="md-nav__link">
      Merkle 树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../crypto/homoencryption/" title="同态加密" class="md-nav__link">
      同态加密
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../crypto/others/" title="其它问题" class="md-nav__link">
      其它问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../crypto/summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      实现
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        实现
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      比特币项目
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-1">
        比特币项目
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin/README/" title="思想诞生的摇篮" class="md-nav__link">
      思想诞生的摇篮
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin/introductin/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin/design/" title="原理和设计" class="md-nav__link">
      原理和设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin/mining/" title="挖矿" class="md-nav__link">
      挖矿
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin/tools/" title="工具" class="md-nav__link">
      工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin/consensus/" title="共识机制" class="md-nav__link">
      共识机制
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin/lightning_network/" title="闪电网络" class="md-nav__link">
      闪电网络
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin/sidechain/" title="侧链" class="md-nav__link">
      侧链
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bitcoin/summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      Ethereum（以太坊）
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        Ethereum（以太坊）
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../ethereum/README/" title="技术落地的实验" class="md-nav__link">
      技术落地的实验
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ethereum/intro/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ethereum/install/" title="安装" class="md-nav__link">
      安装
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ethereum/tools/" title="相关工具" class="md-nav__link">
      相关工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ethereum/design/" title="协议设计" class="md-nav__link">
      协议设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ethereum/smartContract_example01/" title="智能合约示例一" class="md-nav__link">
      智能合约示例一
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ethereum/summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3" type="checkbox" id="nav-6-3">
    
    <label class="md-nav__link" for="nav-6-3">
      Hyperledger（超级账本）
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-3">
        Hyperledger（超级账本）
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../hyperledger/README/" title="商用分布式账本" class="md-nav__link">
      商用分布式账本
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hyperledger/history/" title="诞生与发展" class="md-nav__link">
      诞生与发展
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hyperledger/community/" title="社区组织" class="md-nav__link">
      社区组织
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hyperledger/top_project/" title="五大顶级项目" class="md-nav__link">
      五大顶级项目
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hyperledger/contribute/" title="开发和提交代码" class="md-nav__link">
      开发和提交代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hyperledger/summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Fabric
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Fabric
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1" type="checkbox" id="nav-7-1">
    
    <label class="md-nav__link" for="nav-7-1">
      部署与管理
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-1">
        部署与管理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../fabric/intro/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fabric/1.0/" title="使用 1.0 版本" class="md-nav__link">
      使用 1.0 版本
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1-3" type="checkbox" id="nav-7-1-3">
    
    <label class="md-nav__link" for="nav-7-1-3">
      使用 v0.6
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-7-1-3">
        使用 v0.6
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../fabric/v0.6/README/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fabric/v0.6/install/" title="安装部署" class="md-nav__link">
      安装部署
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fabric/v0.6/usage/" title="使用 chaincode" class="md-nav__link">
      使用 chaincode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fabric/v0.6/membersrcv-usage/" title="权限管理" class="md-nav__link">
      权限管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fabric/v0.6/hyperledger-py/" title="Python 客户端" class="md-nav__link">
      Python 客户端
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fabric/summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2" checked>
    
    <label class="md-nav__link" for="nav-7-2">
      架构与设计
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        架构与设计
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../intro/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        架构设计
      </label>
    
    <a href="./" title="架构设计" class="md-nav__link md-nav__link--active">
      架构设计
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" title="概念术语" class="md-nav__link">
    概念术语
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="区块链服务" class="md-nav__link">
    区块链服务
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="交易" class="md-nav__link">
    交易
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="区块" class="md-nav__link">
    区块
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="世界观" class="md-nav__link">
    世界观
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" title="链码服务" class="md-nav__link">
    链码服务
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" title="接口和操作" class="md-nav__link">
    接口和操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="容器" class="md-nav__link">
    容器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grpc" title="gRPC 消息" class="md-nav__link">
    gRPC 消息
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" title="成员权限管理" class="md-nav__link">
    成员权限管理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" title="新的架构设计" class="md-nav__link">
    新的架构设计
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../protocol/" title="消息协议" class="md-nav__link">
      消息协议
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      区块链
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        区块链
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-1" type="checkbox" id="nav-8-1">
    
    <label class="md-nav__link" for="nav-8-1">
      应用开发
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-1">
        应用开发
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../app_dev/intro/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app_dev/chaincode/" title="链上代码工作原理" class="md-nav__link">
      链上代码工作原理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app_dev/chaincode_example01/" title="示例一：信息公证" class="md-nav__link">
      示例一：信息公证
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app_dev/chaincode_example02/" title="示例二：交易资产" class="md-nav__link">
      示例二：交易资产
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app_dev/chaincode_example03/" title="示例三：数字货币发行与管理" class="md-nav__link">
      示例三：数字货币发行与管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app_dev/chaincode_example04/" title="示例四：学历认证" class="md-nav__link">
      示例四：学历认证
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app_dev/chaincode_example05/" title="示例五：社区能源共享" class="md-nav__link">
      示例五：社区能源共享
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../app_dev/summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2" type="checkbox" id="nav-8-2">
    
    <label class="md-nav__link" for="nav-8-2">
      服务平台设计
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-2">
        服务平台设计
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../baas/README/" title="概述" class="md-nav__link">
      概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../baas/intro/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../baas/bluemix/" title="IBM Bluemix 云区块链服务" class="md-nav__link">
      IBM Bluemix 云区块链服务
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../baas/azure/" title="微软 Azure 云区块链服务" class="md-nav__link">
      微软 Azure 云区块链服务
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../baas/cello/" title="使用超级账本 Cello 搭建区块链服务" class="md-nav__link">
      使用超级账本 Cello 搭建区块链服务
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../baas/summary/" title="本章小结" class="md-nav__link">
      本章小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      性能与评测
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        性能与评测
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../evaluation/README/" title="概述" class="md-nav__link">
      概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../evaluation/intro/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../evaluation/hyperledger/" title="Hyperledger Fabric v0.6" class="md-nav__link">
      Hyperledger Fabric v0.6
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../evaluation/summary/" title="小结" class="md-nav__link">
      小结
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      附录
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        附录
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendix/terms/" title="术语" class="md-nav__link">
      术语
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendix/faq/" title="常见问题" class="md-nav__link">
      常见问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendix/companies/" title="相关组织" class="md-nav__link">
      相关组织
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendix/grpc/" title="ProtoBuf 与 gRPC" class="md-nav__link">
      ProtoBuf 与 gRPC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendix/resources/" title="参考资源链接" class="md-nav__link">
      参考资源链接
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" title="概念术语" class="md-nav__link">
    概念术语
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="区块链服务" class="md-nav__link">
    区块链服务
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="交易" class="md-nav__link">
    交易
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="区块" class="md-nav__link">
    区块
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="世界观" class="md-nav__link">
    世界观
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" title="链码服务" class="md-nav__link">
    链码服务
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" title="接口和操作" class="md-nav__link">
    接口和操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="容器" class="md-nav__link">
    容器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grpc" title="gRPC 消息" class="md-nav__link">
    gRPC 消息
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" title="成员权限管理" class="md-nav__link">
    成员权限管理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" title="新的架构设计" class="md-nav__link">
    新的架构设计
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="_1">架构设计<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p>整个功能架构如下图所示。</p>
<p><img alt="" src="../_images/refarch.png" /></p>
<p>包括三大组件：区块链服务（Blockchain）、链码服务（Chaincode）、成员权限管理（Membership）。</p>
<h2 id="_2">概念术语<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<ul>
<li>Auditability（审计性）：在一定权限和许可下，可以对链上的交易进行审计和检查。</li>
<li>Block（区块）：代表一批得到确认的交易信息的整体，准备被共识加入到区块链中。</li>
<li>Blockchain（区块链）：由多个区块链接而成的链表结构，除了首个区块，每个区块都包括前继区块内容的 hash 值。</li>
<li>Certificate Authority（CA）：负责身份权限管理，又叫 Member Service 或 Identity Service。</li>
<li>Chaincode（链上代码或链码）：区块链上的应用代码，扩展自“智能合约”概念，支持 golang、nodejs 等，运行在隔离的容器环境中。</li>
<li>Committer（提交节点）：1.0 架构中一种 peer 节点角色，负责对 orderer 排序后的交易进行检查，选择合法的交易执行并写入存储。</li>
<li>Confidentiality（保密）：只有交易相关方可以看到交易内容，其它人未经授权则无法看到。</li>
<li>Endorser（背书节点）：1.0 架构中一种 peer 节点角色，负责检验某个交易是否合法，是否愿意为之背书、签名。</li>
<li>Enrollment Certificate Authority（ECA，注册 CA）：负责成员身份相关证书管理的 CA。</li>
<li>Ledger（账本）：包括区块链结构（带有所有的可验证交易信息，但只有最终成功的交易会改变世界观）和当前的世界观（world state）。Ledger 仅存在于 Peer 节点。</li>
<li>MSP（Member Service Provider，成员服务提供者）：成员服务的抽象访问接口，实现对不同成员服务的可拔插支持。</li>
<li>Non-validating Peer（非验证节点）：不参与账本维护，仅作为交易代理响应客户端的 REST 请求，并对交易进行一些基本的有效性检查，之后转发给验证节点。</li>
<li>Orderer（排序节点）：1.0 架构中的共识服务角色，负责排序看到的交易，提供全局确认的顺序。</li>
<li>Permissioned Ledger（带权限的账本）：网络中所有节点必须是经过许可的，非许可过的节点则无法加入网络。</li>
<li>Privacy（隐私保护）：交易员可以隐藏交易的身份，其它成员在无特殊权限的情况下，只能对交易进行验证，而无法获知身份信息。</li>
<li>Transaction（交易）：执行账本上的某个函数调用。具体函数在 chaincode 中实现。</li>
<li>Transactor（交易者）：发起交易调用的客户端。</li>
<li>Transaction Certificate Authority（TCA，交易 CA）：负责维护交易相关证书管理的 CA。</li>
<li>Validating Peer（验证节点）：维护账本的核心节点，参与一致性维护、对交易的验证和执行。</li>
<li>World State（世界观）：是一个键值数据库，chaincode 用它来存储交易相关的状态。</li>
</ul>
<h2 id="_3">区块链服务<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>区块链服务提供一个分布式账本平台。一般地，多个交易被打包进区块中，多个区块构成一条区块链。区块链代表的是账本状态机发生变更的历史过程。</p>
<h3 id="_4">交易<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>交易意味着围绕着某个链码进行操作。</p>
<p>交易可以改变世界状态。</p>
<p>交易中包括的内容主要有：</p>
<ul>
<li>交易类型：目前包括 Deploy、Invoke、Query、Terminate 四种；</li>
<li>uuid：代表交易的唯一编号；</li>
<li>链码编号 chaincodeID：交易针对的链码；</li>
<li>负载内容的 hash 值：Deploy 或 Invoke 时候可以指定负载内容；</li>
<li>交易的保密等级 ConfidentialityLevel；</li>
<li>交易相关的 metadata 信息；</li>
<li>临时生成值 nonce：跟安全机制相关；</li>
<li>交易者的证书信息 cert；</li>
<li>签名信息 signature；</li>
<li>metadata 信息；</li>
<li>时间戳 timestamp。</li>
</ul>
<p>交易的数据结构（Protobuf 格式）定义为</p>
<div class="codehilite"><pre><span></span><span class="kd">message</span> <span class="nc">Transaction</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="n">Type</span> <span class="p">{</span>
        <span class="na">UNDEFINED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="c1">// deploy a chaincode to the network and call `Init` function</span>
        <span class="na">CHAINCODE_DEPLOY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="c1">// call a chaincode `Invoke` function as a transaction</span>
        <span class="na">CHAINCODE_INVOKE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="c1">// call a chaincode `query` function</span>
        <span class="na">CHAINCODE_QUERY</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="c1">// terminate a chaincode; not implemented yet</span>
        <span class="na">CHAINCODE_TERMINATE</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Type</span> <span class="na">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">//store ChaincodeID as bytes so its encrypted value can be stored</span>
    <span class="kt">bytes</span> <span class="na">chaincodeID</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kt">bytes</span> <span class="na">payload</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="kt">bytes</span> <span class="na">metadata</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="kt">string</span> <span class="na">uuid</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">google.protobuf.Timestamp</span> <span class="na">timestamp</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>

    <span class="n">ConfidentialityLevel</span> <span class="na">confidentialityLevel</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
    <span class="kt">string</span> <span class="na">confidentialityProtocolVersion</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="kt">bytes</span> <span class="na">nonce</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>

    <span class="kt">bytes</span> <span class="na">toValidators</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="kt">bytes</span> <span class="na">cert</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
    <span class="kt">bytes</span> <span class="na">signature</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>在 1.0 架构中，一个 transaction 包括如下信息：</p>
<p>[ledger] [channel], <strong>proposal:</strong>[chaincode, <function name, arguments>] <strong>endorsement:</strong>[proposal hash, simulation result, signature]</p>
<ul>
<li>endorsements: proposal hash, simulation result, signature</li>
<li>function-spec: function name, arguments</li>
<li>proposal: [channel,] chaincode, <function-spec></li>
</ul>
<h3 id="_5">区块<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>区块打包交易，确认交易后的世界状态。</p>
<p>一个区块中包括的内容主要有：</p>
<ul>
<li>版本号 version：协议的版本信息；</li>
<li>时间戳 timestamp：由区块提议者设定；</li>
<li>交易信息的默克尔树的根 hash 值：由区块所包括的交易构成；</li>
<li>世界观的默克尔树的根 hash 值：由交易发生后整个世界的状态值构成；</li>
<li>前一个区块的 hash 值：构成链所必须；</li>
<li>共识相关的元数据：可选值；</li>
<li>非 hash 数据：不参与 hash 过程，各个 peer 上的值可能不同，例如本地提交时间、交易处理的返回值等；</li>
</ul>
<p><em>注意具体的交易信息并不存放在区块中。</em></p>
<p>区块的数据结构（Protobuf 格式）定义为</p>
<div class="codehilite"><pre><span></span><span class="kd">message</span> <span class="nc">Block</span> <span class="p">{</span>
    <span class="kt">uint32</span> <span class="na">version</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">google.protobuf.Timestamp</span> <span class="na">timestamp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">repeated</span> <span class="n">Transaction</span> <span class="na">transactions</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="kt">bytes</span> <span class="na">stateHash</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="kt">bytes</span> <span class="na">previousBlockHash</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="kt">bytes</span> <span class="na">consensusMetadata</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="n">NonHashData</span> <span class="na">nonHashData</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>一个真实的区块内容示例：</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;nonHashData&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;localLedgerCommitTimestamp&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;nanos&quot;</span><span class="p">:</span> <span class="mi">975295157</span><span class="p">,</span>
                <span class="nt">&quot;seconds&quot;</span><span class="p">:</span> <span class="mi">1466057539</span>
        <span class="p">},</span>
            <span class="nt">&quot;transactionResults&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;7be1529ee16969baf9f3156247a0ee8e7eee99a6a0a816776acff65e6e1def71249f4cb1cad5e0f0b60b25dd2a6975efb282741c0e1ecc53fa8c10a9aaa31137&quot;</span>
            <span class="p">}</span>
            <span class="p">]</span>
    <span class="p">},</span>
        <span class="nt">&quot;previousBlockHash&quot;</span><span class="p">:</span> <span class="s2">&quot;RrndKwuojRMjOz/rdD7rJD/NUupiuBuCtQwnZG7Vdi/XXcTd2MDyAMsFAZ1ntZL2/IIcSUeatIZAKS6ss7fEvg==&quot;</span><span class="p">,</span>
        <span class="nt">&quot;stateHash&quot;</span><span class="p">:</span> <span class="s2">&quot;TiIwROg48Z4xXFFIPEunNpavMxnvmZKg+yFxKK3VBY0zqiK3L0QQ5ILIV85iy7U+EiVhwEbkBb1Kb7w1ddqU5g==&quot;</span><span class="p">,</span>
        <span class="nt">&quot;transactions&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;chaincodeID&quot;</span><span class="p">:</span> <span class="s2">&quot;CkdnaXRodWIuY29tL2h5cGVybGVkZ2VyL2ZhYnJpYy9leGFtcGxlcy9jaGFpbmNvZGUvZ28vY2hhaW5jb2RlX2V4YW1wbGUwMhKAATdiZTE1MjllZTE2OTY5YmFmOWYzMTU2MjQ3YTBlZThlN2VlZTk5YTZhMGE4MTY3NzZhY2ZmNjVlNmUxZGVmNzEyNDlmNGNiMWNhZDVlMGYwYjYwYjI1ZGQyYTY5NzVlZmIyODI3NDFjMGUxZWNjNTNmYThjMTBhOWFhYTMxMTM3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;payload&quot;</span><span class="p">:</span> <span class="s2">&quot;Cu0BCAESzAEKR2dpdGh1Yi5jb20vaHlwZXJsZWRnZXIvZmFicmljL2V4YW1wbGVzL2NoYWluY29kZS9nby9jaGFpbmNvZGVfZXhhbXBsZTAyEoABN2JlMTUyOWVlMTY5NjliYWY5ZjMxNTYyNDdhMGVlOGU3ZWVlOTlhNmEwYTgxNjc3NmFjZmY2NWU2ZTFkZWY3MTI0OWY0Y2IxY2FkNWUwZjBiNjBiMjVkZDJhNjk3NWVmYjI4Mjc0MWMwZTFlY2M1M2ZhOGMxMGE5YWFhMzExMzcaGgoEaW5pdBIBYRIFMTAwMDASAWISBTIwMDAw&quot;</span><span class="p">,</span>
            <span class="nt">&quot;timestamp&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;nanos&quot;</span><span class="p">:</span> <span class="mi">298275779</span><span class="p">,</span>
                <span class="nt">&quot;seconds&quot;</span><span class="p">:</span> <span class="mi">1466057529</span>
            <span class="p">},</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;7be1529ee16969baf9f3156247a0ee8e7eee99a6a0a816776acff65e6e1def71249f4cb1cad5e0f0b60b25dd2a6975efb282741c0e1ecc53fa8c10a9aaa31137&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>

<h3 id="_6">世界观<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>世界观用于存放链码执行过程中涉及到的状态变量，是一个键值数据库。典型的元素为 <code>[chaincodeID, ckey]: value</code> 结构。</p>
<p>为了方便计算变更后的 hash 值，一般采用默克尔树数据结构进行存储。树的结构由两个参数（<code>numBuckets</code> 和 <code>maxGroupingAtEachLevel</code>）来进行初始配置，并由 <code>hashFunction</code> 配置决定存放键值到叶子节点的方式。显然，各个节点必须保持相同的配置，并且启动后一般不建议变动。</p>
<ul>
<li><code>numBuckets</code>：叶子节点的个数，每个叶子节点是一个桶（bucket），所有的键值被 <code>hashFunction</code> 散列分散到各个桶，决定树的宽度；</li>
<li><code>maxGroupingAtEachLevel</code>：决定每个节点由多少个子节点的 hash 值构成，决定树的深度。</li>
</ul>
<p>其中，桶的内容由它所保存到键值先按照 chaincodeID 聚合，再按照升序方式组成。</p>
<p>一般地，假设某桶中包括 $$ M $$ 个 chaincodeID，对于 $$ chaincodeID_i $$，假设其包括 $$ N $$ 个键值对，则聚合 $$G_i$$ 内容可以计算为：</p>
<p>$$ G_i = Len(chaincodeID_i) + chaincodeID_i + N + \sum_{1}^{N} {len(key_j) + key_j + len(value_j) + value_j} $$</p>
<p>该桶的内容则为</p>
<p>$$ bucket = \sum_{1}^{M} G_i $$</p>
<p><em>注：这里的 <code>+</code> 代表字符串拼接，并非数学运算。</em></p>
<h2 id="_7">链码服务<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>链码包含所有的处理逻辑，并对外提供接口，外部通过调用链码接口来改变世界观。</p>
<h3 id="_8">接口和操作<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>链码需要实现 Chaincode 接口，以被 VP 节点调用。</p>
<div class="codehilite"><pre><span></span><span class="kd">type</span> <span class="nx">Chaincode</span> <span class="kd">interface</span> <span class="p">{</span> <span class="nx">Init</span><span class="p">(</span><span class="nx">stub</span> <span class="o">*</span><span class="nx">ChaincodeStub</span><span class="p">,</span> <span class="nx">function</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="nx">Invoke</span><span class="p">(</span><span class="nx">stub</span> <span class="o">*</span><span class="nx">ChaincodeStub</span><span class="p">,</span> <span class="nx">function</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="nx">Query</span><span class="p">(</span><span class="nx">stub</span> <span class="o">*</span><span class="nx">ChaincodeStub</span><span class="p">,</span> <span class="nx">function</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)}</span>
</pre></div>

<p>链码目前支持的交易类型包括：部署（Deploy）、调用（Invoke）和查询（Query）。</p>
<ul>
<li>部署：VP 节点利用链码创建沙盒，沙盒启动后，处理 protobuf 协议的 shim 层一次性发送包含 ChaincodeID 信息的 REGISTER 消息给 VP 节点，进行注册，注册完成后，VP 节点通过 gRPC 传递参数并调用链码 Init 函数完成初始化；</li>
<li>调用：VP 节点发送 TRANSACTION 消息给链码沙盒的 shim 层，shim 层用传过来的参数调用链码的 Invoke 函数完成调用；</li>
<li>查询：VP 节点发送 QUERY 消息给链码沙盒的 shim 层，shim 层用传过来的参数调用链码的 Query 函数完成查询。</li>
</ul>
<p>不同链码之间可能互相调用和查询。</p>
<h3 id="_9">容器<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>在实现上，链码需要运行在隔离的容器中，超级账本采用了 Docker 作为默认容器。</p>
<p>对容器的操作支持三种方法：build、start、stop，对应的接口为 VM。</p>
<p><div class="codehilite"><pre><span></span><span class="kd">type</span> <span class="nx">VM</span> <span class="kd">interface</span> <span class="p">{</span>
  <span class="nx">build</span><span class="p">(</span><span class="nx">ctxt</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">id</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">env</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">attachstdin</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">attachstdout</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">reader</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Reader</span><span class="p">)</span> <span class="kt">error</span>
  <span class="nx">start</span><span class="p">(</span><span class="nx">ctxt</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">id</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">env</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">attachstdin</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">attachstdout</span> <span class="kt">bool</span><span class="p">)</span> <span class="kt">error</span>
  <span class="nx">stop</span><span class="p">(</span><span class="nx">ctxt</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">id</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">timeout</span> <span class="kt">uint</span><span class="p">,</span> <span class="nx">dontkill</span> <span class="kt">bool</span><span class="p">,</span> <span class="nx">dontremove</span> <span class="kt">bool</span><span class="p">)</span> <span class="kt">error</span>
<span class="p">}</span>
</pre></div>
链码部署成功后，会创建连接到部署它的 VP 节点的 gRPC 通道，以接受后续 Invoke 或 Query 指令。</p>
<h3 id="grpc">gRPC 消息<a class="headerlink" href="#grpc" title="Permanent link">&para;</a></h3>
<p>VP 节点和容器之间通过 gRPC 消息来交互。消息基本结构为</p>
<div class="codehilite"><pre><span></span><span class="kd">message</span> <span class="nc">ChaincodeMessage</span> <span class="p">{</span>

 <span class="kd">enum</span> <span class="n">Type</span> <span class="p">{</span> <span class="na">UNDEFINED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="na">REGISTER</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="na">REGISTERED</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="na">INIT</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="na">READY</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="na">TRANSACTION</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="na">COMPLETED</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="na">ERROR</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span> <span class="na">GET_STATE</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="na">PUT_STATE</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span> <span class="na">DEL_STATE</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="na">INVOKE_CHAINCODE</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="na">INVOKE_QUERY</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span> <span class="na">RESPONSE</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span> <span class="na">QUERY</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span> <span class="na">QUERY_COMPLETED</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span> <span class="na">QUERY_ERROR</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span> <span class="na">RANGE_QUERY_STATE</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span> <span class="p">}</span>

 <span class="n">Type</span> <span class="na">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">google.protobuf.Timestamp</span> <span class="na">timestamp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="kt">bytes</span> <span class="na">payload</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="kt">string</span> <span class="na">uuid</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;}</span>
</pre></div>

<p>当发生链码部署时，容器启动后发送 <code>REGISTER</code> 消息到 VP 节点。如果成功，VP 节点返回 <code>REGISTERED</code> 消息，并发送 <code>INIT</code> 消息到容器，调用链码中的 Init 方法。</p>
<p>当发生链码调用时，VP 节点发送 <code>TRANSACTION</code> 消息到容器，调用其 Invoke 方法。如果成功，容器会返回 <code>RESPONSE</code> 消息。</p>
<p>类似的，当发生链码查询时，VP 节点发送 <code>QUERY</code> 消息到容器，调用其 Query 方法。如果成功，容器会返回 <code>RESPONSE</code> 消息。</p>
<h2 id="_10">成员权限管理<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<p>通过基于 PKI 的成员权限管理，平台可以对接入的节点和客户端的能力进行限制。</p>
<p>证书有三种，Enrollment，Transaction，以及确保安全通信的 TLS 证书。</p>
<ul>
<li>注册证书 ECert：颁发给提供了注册凭证的用户或节点，一般长期有效；</li>
<li>交易证书 TCert：颁发给用户，控制每个交易的权限，一般针对某个交易，短期有效。</li>
<li>通信证书 TLSCert：控制对网络的访问，并且防止窃听。</li>
</ul>
<p><img alt="" src="../_images/memserv-components.png" /></p>
<h2 id="_11">新的架构设计<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<p>目前，VP 节点执行了所有的操作，包括接收交易，进行交易验证，进行一致性达成，进行账本维护等。这些功能的耦合导致节点性能很难进行扩展。</p>
<p>新的思路就是对这些功能进行解耦，让每个功能都相对单一，容易进行扩展。社区内已经有了一些讨论。</p>
<p>Fabric 1.0 的设计采用了适当的解耦，根据功能将节点角色解耦开，让不同节点处理不同类型的工作负载。</p>
<p><img alt="示例工作过程" src="../_images/dataflow.png" /></p>
<ul>
<li>客户端：客户端应用使用 SDK 来跟 Fabric 打交道，构造合法的交易提案提交给 endorser；收集到足够多 endorser 支持后可以构造合法的交易请求，发给 orderer 或代理节点。</li>
<li>Endorser peer：负责对来自客户端的交易进行合法性和 ACL 权限检查（模拟交易），通过则签名并返回结果给客户端。</li>
<li>Committer peer：负责维护账本，将达成一致顺序的批量交易结果进行状态检查，生成区块，执行合法的交易，并写入账本，同一个物理节点可以同时担任 endorser 和 committer 的 角色。</li>
<li>Orderer：仅负责排序，给交易们一个全局的排序，一般不需要跟账本和交易内容打交道。</li>
<li>CA：负责所有证书的维护，遵循 PKI。</li>
</ul>
<p><img alt="示例交易过程" src="../_images/transaction_flow.png" /></p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../intro/" title="简介" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                简介
              </span>
            </div>
          </a>
        
        
          <a href="../protocol/" title="消息协议" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                消息协议
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            @2018 wohugb.github.io
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="http://wohugb.github.io" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/wohugb" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/wohugb" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/wohugb" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.6cdc17f0.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              <script src="../../assets/javascripts/lunr/lunr.zh.js"></script>
            
          
          
        
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>